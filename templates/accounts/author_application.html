{% extends 'main/base.html' %}
{% load static %}

{% block title %}Become Author - KRONIK{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-form-container author-container">
        <h2 class="auth-title">–°—Ç–∞—Ç—å –∞–≤—Ç–æ—Ä–æ–º <span class="bunny-icon"><img src="/static/icons/bunny.svg" alt="Dark mode" width="32" height="32"></span></h2>
        
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        
        <div class="author-info-text">
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ–º—å—é KRONIK! –ê–≤—Ç–æ—Ä—ã –Ω–∞—à–µ–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–µ–ª—è—Ç—Å—è –∑–Ω–∞–Ω–∏—è–º–∏ 
            —á–µ—Ä–µ–∑ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç –∏ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è. 
            –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É!</p>
        </div>
        
        <div class="author-benefits">
            <div class="benefit-item">
                <div class="benefit-icon">üí∞</div>
                <div class="benefit-text">
                    <h4>–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è</h4>
                    <p>–ü–æ–ª—É—á–∞–π—Ç–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –∑–∞ —Å–≤–æ–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</p>
                </div>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üèÜ</div>
                <div class="benefit-text">
                    <h4>–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ</h4>
                    <p>–°—Ç–∞–Ω—å—Ç–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–º –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ</p>
                </div>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üöÄ</div>
                <div class="benefit-text">
                    <h4>–†–æ—Å—Ç</h4>
                    <p>–†–∞–∑–≤–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–º–∞–Ω–¥—ã KRONIK</p>
                </div>
            </div>
        </div>
        
        <div class="application-steps">
            <div class="step active">
                <div class="step-number">1</div>
                <div class="step-text">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã</div>
            </div>
            <div class="step-connector"></div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-text">–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏</div>
            </div>
            <div class="step-connector"></div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-text">–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∞</div>
            </div>
        </div>
        
        <form method="POST" class="auth-form" id="author-application-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="id_credentials">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—ã—Ç <span class="required">*</span></label>
                {{ form.credentials }}
                {% if form.credentials.errors %}
                    <div class="form-error">{{ form.credentials.errors }}</div>
                {% endif %}
                <small class="form-help">–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–º –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏, –æ–ø—ã—Ç–µ, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö –∏ –ø–æ—á–µ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å –∞–≤—Ç–æ—Ä–æ–º.</small>
            </div>
            
            <div class="form-group">
                <label>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç–∏ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã <span class="required">*</span></label>
                <div class="expertise-areas-container">
                    {% for choice in form.expertise_areas %}
                        <label>
                            {{ choice.tag }}
                            {{ choice.choice_label }}
                        </label>
                    {% endfor %}
                </div>
                {% if form.expertise_areas.errors %}
                    <div class="form-error">{{ form.expertise_areas.errors }}</div>
                {% endif %}
                <small class="form-help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±–ª–∞—Å—Ç–µ–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã —è–≤–ª—è–µ—Ç–µ—Å—å —ç–∫—Å–ø–µ—Ä—Ç–æ–º.</small>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="auth-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                <a href="{% url 'profile' %}" class="cancel-button">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
        
        <div class="auth-note">
            <p><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏ –Ω–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç –µ–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 2-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –∏ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –ø–æ email.</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('author-application-form');
        const credentialsField = document.getElementById('id_credentials');
        
        // –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function(e) {
            let isValid = true;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª—è credentials
            if (!credentialsField.value.trim()) {
                isValid = false;
                credentialsField.style.borderColor = '#ff4757';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                let errorDiv = credentialsField.nextElementSibling;
                if (!errorDiv || !errorDiv.classList.contains('form-error')) {
                    errorDiv = document.createElement('div');
                    errorDiv.className = 'form-error';
                    errorDiv.textContent = '–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è';
                    credentialsField.parentNode.insertBefore(errorDiv, credentialsField.nextSibling);
                }
            } else {
                credentialsField.style.borderColor = '';
                let errorDiv = credentialsField.nextElementSibling;
                if (errorDiv && errorDiv.classList.contains('form-error')) {
                    errorDiv.remove();
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã
            const checkboxes = document.querySelectorAll('input[name="expertise_areas"]');
            let atLeastOneChecked = false;
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    atLeastOneChecked = true;
                }
            });
            
            const expertiseContainer = document.querySelector('.expertise-areas-container');
            
            if (!atLeastOneChecked) {
                isValid = false;
                expertiseContainer.style.borderColor = '#ff4757';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                let errorDiv = expertiseContainer.nextElementSibling;
                if (!errorDiv || !errorDiv.classList.contains('form-error')) {
                    errorDiv = document.createElement('div');
                    errorDiv.className = 'form-error';
                    errorDiv.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ–±–ª–∞—Å—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã';
                    expertiseContainer.parentNode.insertBefore(errorDiv, expertiseContainer.nextSibling);
                }
            } else {
                expertiseContainer.style.borderColor = '';
                let errorDiv = expertiseContainer.nextElementSibling;
                if (errorDiv && errorDiv.classList.contains('form-error')) {
                    errorDiv.remove();
                }
            }
            
            if (!isValid) {
                e.preventDefault();
            }
        });
        
        // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
        credentialsField.addEventListener('input', function() {
            this.style.borderColor = '';
            const errorDiv = this.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('form-error')) {
                errorDiv.remove();
            }
        });
        
        // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–±–ª–∞—Å—Ç–µ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã
        const checkboxes = document.querySelectorAll('input[name="expertise_areas"]');
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —á–µ–∫–±–æ–∫—Å
                let anyChecked = false;
                checkboxes.forEach(cb => {
                    if (cb.checked) anyChecked = true;
                });
                
                if (anyChecked) {
                    const expertiseContainer = document.querySelector('.expertise-areas-container');
                    expertiseContainer.style.borderColor = '';
                    const errorDiv = expertiseContainer.nextElementSibling;
                    if (errorDiv && errorDiv.classList.contains('form-error')) {
                        errorDiv.remove();
                    }
                }
            });
        });
        
        // –î–µ–ª–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω—ã–º–∏
        document.querySelectorAll('.expertise-areas-container input[type="checkbox"]').forEach(checkbox => {
            checkbox.style.opacity = '1';
            checkbox.style.position = 'relative';
            checkbox.style.width = 'auto';
            checkbox.style.height = 'auto';
            checkbox.style.margin = '0 8px 0 0';
        });
    });
</script>
{% endblock %}